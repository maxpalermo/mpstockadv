{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script type="module">
        const mpstockadvImportExportEndpoints = {
            mvtReason: '{{ path('mpstockadv_admin_stockimportexport_import_mvt_reason') }}',
            orders: '{{ path('mpstockadv_admin_stockimportexport_import_orders') }}',
            xml: '{{ path('mpstockadv_admin_stockimportexport_import_xml') }}'
        };
        import('{{ asset('../modules/mpstockadv/views/js/controllers/admin/importExport.js') }}')
            .then(({ default: ImportExport }) => {
                console.log('ImportExport loaded');
                const importDialog = new ImportExport(mpstockadvImportExportEndpoints);
                importDialog.showDialog('In attesa di avviare un\'importazione...');
            })
            .catch(e => {
                console.error('Errore nel caricamento del modulo ImportExport:', e);
            });
    </script>
{% endblock %}

{% block content %}
	<div class="container mt-4">
		<h2 class="mb-4">Importazione Movimenti Magazzino</h2>

		<!-- Sezione 1: Importa Tipi di Movimento (CSV/JSON) -->
		<section class="card mb-4">
			<div class="card-header bg-primary text-white">
				<h5 class="mb-0">Importa Tipi di Movimento</h5>
			</div>
			<div class="card-body">
				<p>Carica un file
					<strong>CSV</strong>
					o
					<strong>JSON</strong>
					per importare i tipi di movimento magazzino dalle versioni precedenti del modulo.</p>
				<form id="import-mvt-reason-form" enctype="multipart/form-data">
					<div class="form-group mb-2">
						<label for="mvt-reason-type">Tipo di file da importare:</label>
						<select name="mvt_reason_type" id="mvt-reason-type" class="form-control" required>
							<option value="all">File completo</option>
							<option value="reasons">File dei tipi di movimento senza nome</option>
							<option value="lang">File lingua dei tipi di movimento</option>
						</select>
					</div>
					<div class="form-group mb-2">
						<label for="mvt-reason-file" class="form-label">Seleziona file</label>
						<div class="input-group">
							<input type="file" name="mvt_reason_file" id="mvt-reason-file" accept=".csv,.json" class="form-control" required>
							<label class="input-group-text" for="mvt-reason-file">Scegli...</label>
						</div>
						<small id="mvt-reason-file-name" class="form-text text-muted"></small>
					</div>
					<button type="submit" class="btn btn-success mt-2">Importa Tipi Movimento</button>
				</form>
			</div>
		</section>

		<!-- Sezione 2: Importa Movimenti da Ordini PrestaShop -->
		<section class="card mb-4">
			<div class="card-header bg-info text-white">
				<h5 class="mb-0">Importa Movimenti da Ordini PrestaShop</h5>
			</div>
			<div class="card-body">
				<p>Importa i movimenti di magazzino generati dagli ordini gi√† presenti in PrestaShop.</p>
				<form id="import-orders-form">
					<button type="submit" class="btn btn-primary">Importa Movimenti da Ordini</button>
				</form>
			</div>
		</section>

		<!-- Sezione 3: Importa Movimenti da Documento XML -->
		<section class="card mb-4">
			<div class="card-header bg-secondary text-white">
				<h5 class="mb-0">Importa Movimenti da Documento XML</h5>
			</div>
			<div class="card-body">
				<p>Carica un file
					<strong>XML</strong>
					esportato da un'applicazione esterna per importare i movimenti di magazzino.</p>
				<form id="import-xml-form" enctype="multipart/form-data">
					<div class="form-group mb-2">
						<label for="xml-file" class="form-label">Seleziona file XML</label>
						<div class="input-group">
							<input type="file" name="xml_file" id="xml-file" accept=".xml" class="form-control" required>
							<label class="input-group-text" for="xml-file">Scegli...</label>
						</div>
						<small id="xml-file-name" class="form-text text-muted"></small>
					</div>
					<button type="submit" class="btn btn-warning mt-2">Importa da XML</button>
				</form>
			</div>
		</section>
	</div>

	<!-- Dialog per stato importazione e errori -->
	<dialog id="import-status-dialog">
		<form method="dialog">
			<h4 id="import-status-title">Stato Importazione</h4>
			<div id="import-status-content">
				<p>In attesa di avviare un'importazione...</p>
			</div>
			<menu>
				<button id="close-dialog" class="btn btn-secondary">Chiudi</button>
			</menu>
		</form>
	</dialog>

{% endblock %}
